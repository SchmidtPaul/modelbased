<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data grids • modelbased</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Data grids">
<meta property="og:description" content="modelbased">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modelbased</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Features</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/visualisation_matrix.html">Data grids</a>
    </li>
    <li>
      <a href="../articles/estimate_means.html">Marginal means</a>
    </li>
    <li>
      <a href="../articles/estimate_contrasts.html">Contrast analysis</a>
    </li>
    <li>
      <a href="../articles/estimate_response.html">Use a model to make predictions</a>
    </li>
    <li>
      <a href="../articles/estimate_smooth.html">Describe non-linear curves</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/easystats/modelbased/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="visualisation_matrix_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data grids</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/easystats/modelbased/blob/master/vignettes/visualisation_matrix.Rmd" class="external-link"><code>vignettes/visualisation_matrix.Rmd</code></a></small>
      <div class="hidden name"><code>visualisation_matrix.Rmd</code></div>

    </div>

    
    
<p>Sometimes, for instance for <strong>visualization</strong> purposes, we want to extract a <strong>reference grid</strong> (or <em>data grid</em>) of our dataset, that we will call a <strong>visualisation matrix</strong>. This reference grid usually contains the same variables than the original dataset, but reorganized in a particular, <strong>balanced</strong>, way. For instance, it might contain all the combinations of factors, or equally spread points of a continuous variable. These reference grids are often used as data for predictions of statistical models, to help us represent and understand them.</p>
<div id="simple-linear-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#simple-linear-regression" class="anchor"></a>Simple linear regression</h1>
<p>For instance, let’s fit a simple linear model that models the relationship between <code>Sepal.Width</code> and <code>Sepal.Length</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/" class="external-link">parameters</a></span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span>
<span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html" class="external-link">model_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<pre><code>&gt; Parameter    | Coefficient |   SE |        95% CI | t(148) |      p
&gt; -------------------------------------------------------------------
&gt; (Intercept)  |        3.42 | 0.25 | [ 2.92, 3.92] |  13.48 | &lt; .001
&gt; Sepal.Length |       -0.06 | 0.04 | [-0.15, 0.02] |  -1.44 | 0.152</code></pre>
<p>The most obvious way of representing this model is to plot the data points and add the regression line using the <code>geom_smooth</code> function from <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/see/" class="external-link">see</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/theme_modern.html" class="external-link">theme_modern</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="visualisation_matrix_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
<p>But how to “access” the data of this regression line? One option is to select some values of of the predictor (<code>Sepal.Length</code>), and <strong>predict</strong> the response (<code>Sepal.Width</code>) using the model. Using these <em>x</em> and <em>y</em> points, we can then create the regression line.</p>
<p>Let’s try the <code>visualisation_matrix</code> function from the <code>estimate</code> package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/modelbased/" class="external-link">modelbased</a></span><span class="op">)</span>

<span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span><span class="st">"Sepal.Length"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>&gt;    Sepal.Length
&gt; 1           4.3
&gt; 2           4.7
&gt; 3           5.1
&gt; 4           5.5
&gt; 5           5.9
&gt; 6           6.3
&gt; 7           6.7
&gt; 8           7.1
&gt; 9           7.5
&gt; 10          7.9</code></pre>
<p>If we pass a numeric variable to the function, it will return a vector of <strong>equally spread points</strong> (having the same range, i.e., the same minimum and maximum, than the original data). The default <strong>length</strong> is 10, but we can adjust that through the <code>length</code> argument. Let’s generate predictions using this reference grid of the predictor.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span><span class="st">"Sepal.Length"</span><span class="op">]</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">newdata</span><span class="op">$</span><span class="va">Predicted_Sepal.Width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdata</span><span class="op">)</span>
<span class="va">newdata</span></code></pre></div>
<pre><code>&gt;   Sepal.Length Predicted_Sepal.Width
&gt; 1          4.3                   3.2
&gt; 2          5.2                   3.1
&gt; 3          6.1                   3.0
&gt; 4          7.0                   3.0
&gt; 5          7.9                   2.9</code></pre>
<p>Now that we have our <em>x</em> and <em>y</em> values, we can plot the line as an overlay to the actual data points:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Predicted_Sepal.Width</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/theme_modern.html" class="external-link">theme_modern</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="visualisation_matrix_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<p>As we can see, it is quite similar to the previous plot. So, when can this be useful?</p>
</div>
<div id="mixed-models" class="section level1">
<h1 class="hasAnchor">
<a href="#mixed-models" class="anchor"></a>Mixed models</h1>
<p>Data grids are useful to represent more complex models. For instance, in the models above, the <strong>negative</strong> relationship between the length and width of the sepals is in fact biased by the presence of three different species. One way of adjusting the model for this grouping structure is to add it as a <strong>random effect</strong> in a <strong>mixed model</strong>. In the model below, the “fixed” effects (the parameters of interest) will be adjusted (“averaged over”) to the random effects.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Species</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span>
<span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html" class="external-link">model_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<pre><code>&gt; Parameter    | Coefficient |   SE |       95% CI | t(146) |      p
&gt; ------------------------------------------------------------------
&gt; (Intercept)  |        1.04 | 0.43 | [0.21, 1.88] |   2.45 | 0.014 
&gt; Sepal.Length |        0.34 | 0.05 | [0.25, 0.43] |   7.47 | &lt; .001</code></pre>
<p>As we can see, when adjusting for the species, the relationship between the two variables <strong>has become positive</strong>!</p>
<p>We can represent it using the same procedure as above (note the <code>re.form = NA</code> in the <code>predict</code> function to say that the random variable is not present in the new dataset).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span><span class="st">"Sepal.Length"</span><span class="op">]</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">newdata</span><span class="op">$</span><span class="va">Predicted_Sepal.Width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdata</span>, re.form <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Predicted_Sepal.Width</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/theme_modern.html" class="external-link">theme_modern</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="visualisation_matrix_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div id="fixed-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#fixed-variables" class="anchor"></a>Fixed variables</h1>
<p>The above way of constructing the reference grid, i.e., by providing a single column of data to the function, is almost equivalent to the following:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">iris</span>, target <span class="op">=</span> <span class="st">"Sepal.Length"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">newdata</span></code></pre></div>
<pre><code>&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
&gt; 1          4.3         3.1          3.8         1.2  setosa
&gt; 2          5.2         3.1          3.8         1.2  setosa
&gt; 3          6.1         3.1          3.8         1.2  setosa
&gt; 4          7.0         3.1          3.8         1.2  setosa
&gt; 5          7.9         3.1          3.8         1.2  setosa</code></pre>
<p>However, the other variables (present in the dataframe but not selected as <code>target</code>) are “fixed”, <em>i.e.</em>, they are maintained at specific values. This is useful when we have other variables in the model in whose effect we are not interested.</p>
<p>By default, <strong>factors</strong> are fixed by their <strong>“reference” level</strong> and <strong>numeric variables</strong> are fixed at their <strong>mean</strong>. However, this can be easily changed:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">iris</span>, target <span class="op">=</span> <span class="st">"Sepal.Length"</span>, numerics <span class="op">=</span> <span class="st">"min"</span><span class="op">)</span>
<span class="va">newdata</span></code></pre></div>
<pre><code>&gt;    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
&gt; 1           4.3           2            1         0.1  setosa
&gt; 2           4.7           2            1         0.1  setosa
&gt; 3           5.1           2            1         0.1  setosa
&gt; 4           5.5           2            1         0.1  setosa
&gt; 5           5.9           2            1         0.1  setosa
&gt; 6           6.3           2            1         0.1  setosa
&gt; 7           6.7           2            1         0.1  setosa
&gt; 8           7.1           2            1         0.1  setosa
&gt; 9           7.5           2            1         0.1  setosa
&gt; 10          7.9           2            1         0.1  setosa</code></pre>
</div>
<div id="target-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#target-variables" class="anchor"></a>Target variables</h1>
<p>If more than one target variable is selected, <code>visualisation_matrix</code> will return the <strong>combination</strong> of them (<em>i.e.</em>, all unique values crossed together). This can be useful in the case of an <strong>interaction</strong> between a numeric variable and a factor.</p>
<p>Let’s visualise the regression line for each of the levels of <code>Species</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">~</span> <span class="va">Sepal.Length</span> <span class="op">*</span> <span class="va">Species</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">iris</span>, target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"Species"</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">newdata</span><span class="op">$</span><span class="va">Predicted_Sepal.Width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdata</span><span class="op">)</span>
<span class="va">newdata</span></code></pre></div>
<pre><code>&gt;    Sepal.Length    Species Sepal.Width Petal.Width Predicted_Sepal.Width
&gt; 1           4.3     setosa         3.1         1.2                   2.9
&gt; 2           5.2     setosa         3.1         1.2                   3.6
&gt; 3           6.1     setosa         3.1         1.2                   4.3
&gt; 4           7.0     setosa         3.1         1.2                   5.0
&gt; 5           7.9     setosa         3.1         1.2                   5.7
&gt; 6           4.3 versicolor         3.1         1.2                   2.2
&gt; 7           5.2 versicolor         3.1         1.2                   2.5
&gt; 8           6.1 versicolor         3.1         1.2                   2.8
&gt; 9           7.0 versicolor         3.1         1.2                   3.1
&gt; 10          7.9 versicolor         3.1         1.2                   3.4
&gt; 11          4.3  virginica         3.1         1.2                   2.4
&gt; 12          5.2  virginica         3.1         1.2                   2.7
&gt; 13          6.1  virginica         3.1         1.2                   2.9
&gt; 14          7.0  virginica         3.1         1.2                   3.1
&gt; 15          7.9  virginica         3.1         1.2                   3.3</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Predicted_Sepal.Width</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/theme_modern.html" class="external-link">theme_modern</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="visualisation_matrix_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
</div>
<div id="preserve-range" class="section level1">
<h1 class="hasAnchor">
<a href="#preserve-range" class="anchor"></a>Preserve range</h1>
<p>However, it is generally not a good practice to extend the regression lines beyond the range of its original data, as it is the case here for the <strong>red line</strong>. The <code>preserve_range</code> option allows to remove observations that are “outside” the original dataset (however, the length should be increased to improve the precision toward the edges):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">iris</span>,
  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"Species"</span><span class="op">)</span>,
  length <span class="op">=</span> <span class="fl">100</span>,
  preserve_range <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">newdata</span><span class="op">$</span><span class="va">Predicted_Sepal.Width</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdata</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Sepal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Width</span>, color <span class="op">=</span> <span class="va">Species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Predicted_Sepal.Width</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/theme_modern.html" class="external-link">theme_modern</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="visualisation_matrix_files/figure-html/unnamed-chunk-15-1.png" width="100%"></p>
</div>
<div id="visualising-an-interaction-between-two-numeric-variables-three-way-interaction" class="section level1">
<h1 class="hasAnchor">
<a href="#visualising-an-interaction-between-two-numeric-variables-three-way-interaction" class="anchor"></a>Visualising an interaction between two numeric variables (three-way interaction)</h1>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Petal.Length</span> <span class="op">*</span> <span class="va">Petal.Width</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span>
<span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html" class="external-link">model_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<pre><code>&gt; Parameter                  | Coefficient |   SE |         95% CI | t(146) |      p
&gt; ----------------------------------------------------------------------------------
&gt; (Intercept)                |        4.58 | 0.11 | [ 4.36,  4.80] |  40.89 | &lt; .001
&gt; Petal.Length               |        0.44 | 0.07 | [ 0.31,  0.57] |   6.74 | &lt; .001
&gt; Petal.Width                |       -1.24 | 0.22 | [-1.67, -0.81] |  -5.65 | &lt; .001
&gt; Petal.Length * Petal.Width |        0.19 | 0.03 | [ 0.12,  0.25] |   5.62 | &lt; .001</code></pre>
<p>This idea can also be used to visualise interactions between two numeric variables, <strong>aka the nightmare of every scientist</strong>. One possibility is to basically represent the relationship between the response and one predictor <strong>at a few representative values of the second predictor</strong>.</p>
<p>In this case, we will represent the regression line between <code>Sepal.Length</code> and <code>Petal.Length</code> and a 5 equally spaced values of <code>Petal.Length</code>, to get a feel for the interaction.</p>
<p>We can obtain the right reference grid quite easily by chaining two <code>visualisation_matrix</code> together as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>

<span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="st">"Petal.Width"</span>, length <span class="op">=</span> <span class="fl">5</span>, numerics <span class="op">=</span> <span class="st">"combination"</span><span class="op">)</span></code></pre></div>
<p>What did we do here? We started by generating a reference grid containing all the combinations between the 10 equally spread values of the two target variables, creating <code>10 * 10 = 100</code> rows. The next step was to reduce <code>Petal.Length</code> to a set of 5 values, but without touching the other variables (<em>i.e.</em>, keeping the 10 values created for <code>Petal.Length</code>). This was achieved using <code>numerics = "combination"</code>.</p>
<p>We can then visualise it as follows:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span><span class="op">$</span><span class="va">Predicted_Sepal.Length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdata</span><span class="op">)</span>

<span class="va">iris</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Petal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span>, color <span class="op">=</span> <span class="va">Petal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Predicted_Sepal.Length</span>, group <span class="op">=</span> <span class="va">Petal.Width</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/theme_modern.html" class="external-link">theme_modern</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="visualisation_matrix_files/figure-html/unnamed-chunk-18-1.png" width="100%"></p>
<p>Such plot can be more clear by expressing the interaction variable in terms of deviations from the mean (as a standardized variable).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span><span class="op">)</span>, length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="st">"Petal.Width"</span>,
    length <span class="op">=</span> <span class="fl">3</span>,
    numerics <span class="op">=</span> <span class="st">"combination"</span>,
    standardize <span class="op">=</span> <span class="cn">TRUE</span>,
    reference <span class="op">=</span> <span class="va">iris</span>
  <span class="op">)</span>

<span class="va">newdata</span><span class="op">$</span><span class="va">Predicted_Sepal.Length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">newdata</span><span class="op">)</span>


<span class="co"># Express values in an abstract way</span>
<span class="va">newdata</span><span class="op">$</span><span class="va">Petal.Width</span> <span class="op">&lt;-</span> <span class="fu">effectsize</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/effectsize/reference/format_standardize.html" class="external-link">format_standardize</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">$</span><span class="va">Petal.Width</span>, reference <span class="op">=</span> <span class="va">iris</span><span class="op">$</span><span class="va">Petal.Width</span><span class="op">)</span>

<span class="va">iris</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Petal.Length</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/geom_point2.html" class="external-link">geom_point2</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Petal.Width</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Only shapes from 21 to 25 have a fill aesthetic</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">newdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Predicted_Sepal.Length</span>, color <span class="op">=</span> <span class="va">Petal.Width</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_d</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://easystats.github.io/see/reference/theme_modern.html" class="external-link">theme_modern</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="visualisation_matrix_files/figure-html/unnamed-chunk-19-1.png" width="100%"></p>
<p>As the <code>Petal.Width</code> increases (becomes yellow), the coefficient between <code>Petal.Length</code> and <code>Sepal.Length</code> increases (the slope is more steep). Although, as we can guess, this in fact captures the underlying effect of species… <strong>but we’ll leave discussing the meaningfulness of your models to you :)</strong></p>
</div>
<div id="tips-and-tricks" class="section level1">
<h1 class="hasAnchor">
<a href="#tips-and-tricks" class="anchor"></a>Tips and Tricks</h1>
<div id="visualization_matrix-also-runs-directly-on-model-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization_matrix-also-runs-directly-on-model-objects" class="anchor"></a><code>visualization_matrix()</code> also runs directly on model objects</h2>
<p>To illustrate this, let’s set up a <strong>general additive mixed model (GAMM)</strong>, where we are going to specify a <strong>smooth term</strong> (a non-linear relationship; specified by <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s()</a></code> function) and some <strong>random effects</strong> structure.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gamm4</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">gamm4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4</a></span><span class="op">(</span>
  formula <span class="op">=</span> <span class="va">Petal.Length</span> <span class="op">~</span> <span class="va">Petal.Width</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">Sepal.Length</span><span class="op">)</span>,
  random <span class="op">=</span> <span class="op">~</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">Species</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">iris</span>
<span class="op">)</span></code></pre></div>
<p>One can directly extract the visualization matrix for this model by entering the entire object into the function:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">model</span>, length <span class="op">=</span> <span class="fl">3</span>, include_random <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>&gt;   Petal.Width Sepal.Length
&gt; 1         0.1          4.3
&gt; 2         1.3          4.3
&gt; 3         2.5          4.3
&gt; 4         0.1          6.1
&gt; 5         1.3          6.1
&gt; 6         2.5          6.1
&gt; 7         0.1          7.9
&gt; 8         1.3          7.9
&gt; 9         2.5          7.9</code></pre>
<p>We also skip the smooth term if we are interested only in the fixed effects:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">model</span>, length <span class="op">=</span> <span class="fl">3</span>, include_random <span class="op">=</span> <span class="cn">FALSE</span>, include_smooth <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>&gt;   Petal.Width
&gt; 1         0.1
&gt; 2         1.3
&gt; 3         2.5</code></pre>
<p>We can also include random effects:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/visualisation_matrix.html">visualisation_matrix</a></span><span class="op">(</span><span class="va">model</span>, length <span class="op">=</span> <span class="fl">3</span>, include_random <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>&gt;    Petal.Width Sepal.Length    Species
&gt; 1          0.1          4.3     setosa
&gt; 2          1.3          4.3     setosa
&gt; 3          2.5          4.3     setosa
&gt; 4          0.1          6.1     setosa
&gt; 5          1.3          6.1     setosa
&gt; 6          2.5          6.1     setosa
&gt; 7          0.1          7.9     setosa
&gt; 8          1.3          7.9     setosa
&gt; 9          2.5          7.9     setosa
&gt; 10         0.1          4.3 versicolor
&gt; 11         1.3          4.3 versicolor
&gt; 12         2.5          4.3 versicolor
&gt; 13         0.1          6.1 versicolor
&gt; 14         1.3          6.1 versicolor
&gt; 15         2.5          6.1 versicolor
&gt; 16         0.1          7.9 versicolor
&gt; 17         1.3          7.9 versicolor
&gt; 18         2.5          7.9 versicolor
&gt; 19         0.1          4.3  virginica
&gt; 20         1.3          4.3  virginica
&gt; 21         2.5          4.3  virginica
&gt; 22         0.1          6.1  virginica
&gt; 23         1.3          6.1  virginica
&gt; 24         2.5          6.1  virginica
&gt; 25         0.1          7.9  virginica
&gt; 26         1.3          7.9  virginica
&gt; 27         2.5          7.9  virginica</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://dominiquemakowski.github.io/" class="external-link external-link">Dominique Makowski</a>, <a href="https://github.com/strengejacke" class="external-link external-link">Daniel Lüdecke</a>, <a href="https://github.com/mattansb" class="external-link external-link">Mattan S. Ben-Shachar</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
